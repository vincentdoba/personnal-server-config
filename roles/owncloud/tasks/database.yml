---
- name: Add remote user as sudoer for owncloud
  lineinfile: dest=/etc/sudoers state=present line="{{ansible_ssh_user}} ALL=(ALL:ALL) ALL"

- name: Reload sudo configuration after adding remote user for owncloud
  service: name=sudo state=restarted

- name: Create owncloud database user
  become: yes
  become_method: sudo
  become_user: postgres
  postgresql_user: name={{owncloud_database_user}} password={{owncloud_database_user_password}} role_attr_flags=NOSUPERUSER,CREATEDB state=present

- name: Create owncloud database
  become: yes
  become_method: sudo
  become_user: postgres
  postgresql_db: name={{owncloud_database_name}} owner={{owncloud_database_user}} state=present 

- name: Remove remote user as sudoer for owncloud
  lineinfile: dest=/etc/sudoers state=absent line="{{ansible_ssh_user}} ALL=(ALL:ALL) ALL"

- name: Reload sudo configuration after removing remote user for owncloud
  service: name=sudo state=restarted
