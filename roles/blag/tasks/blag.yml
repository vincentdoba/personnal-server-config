---
- name: Create blag directory
  file: path=/home/sites/blag state=directory recurse=yes owner=www-data group=www-data mode=0755

# TODO change it with clone of git server
- name: Create blag output directory
  file: path=/home/sites/blag/output state=directory owner=www-data group=www-data mode=0755

# TODO change it with generation of site
- name: Copy temporary blag index file
  copy: dest=/home/sites/blag/output/index.html src=index.html owner=www-data group=www-data mode=0644

- name: Create blag virtual host
  template: src=virtual_host_config dest=/etc/nginx/sites-available/blag
  notify: Reload nginx
 
- name: Create blag link in site-enabled
  file: src=/etc/nginx/sites-available/blag state=link dest=/etc/nginx/sites-enabled/blag
  notify: Reload nginx 

- name: Create line for blag in /etc/hosts
  lineinfile: dest=/etc/hosts line="127.0.0.1 {{ blag_hostname }}" insertafter="^127"
